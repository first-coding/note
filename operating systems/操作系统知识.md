- **CPU寻址方式（8086）**：分为三类：
	- **寄存器寻址**：即数在寄存器中，cpu直接从寄存器中获取数据即可。
	- **立即数寻址**：数直接给cpu，不通过任何存储设备。
	- **内存寻址**：数在内存中，访问内存的方式用“**段基址：段内偏移地址（有效地址）”** ，**默认数据段寄存器是DS**。内存寻址又可以分为四种：
		- **直接寻址**：直接通过一个数给出偏移地址，然后通过段基址 * 16（乘多少看寄存器是几位的）+给出的偏移地址（默认的段基址为DS）。也可以设置段基址寄存器。cpu通过计算出来的结果去访问内存对应的位置。 
		- **基址寻址**：通过一个基址寄存器存储基地址，加上一个偏移量得到有效地址。（用于实现程序在内存中的定位和加载）
		- **变址寻址**：通过一个变址寄存器存储一个偏移地址，加上一个基地址得到有效地址。（用于实现数组操作和表格访问等任务）
		- **基址变址寻址**：也是通过段基址+偏移量得到内存地址，只不过偏移量的值为基址寄存器和变址寄存器的值相加得到的。
- **内存模型**： ^f6a5f1
	- **平坦模型**：整个内存被视为一个连续的，单一的地址空间。**每个内存单元都有唯一的地址**，通常用于现代计算机系统。
	- **分段模型**：将内存划分为不同的段，每个段有不同大小，属性。**每个段有一个段选择子（Segment Selector）**。它指向一个描述符表中的段描述符，这个描述符包含了段的起始地址、大小、权限等信息。
		- **段选择子**：是一个16位的值，**两个部分：段索引（Index）和请求特权级别（Requested Privilege Level，RPL）**
	- **分页模型**：将内存划分为固定大小的页，虚拟内存和物理内存都被划分为这些大小相同的页面。操作系统维护一个页表（Page Table），将虚拟地址映射到物理地址。分页模型提供了虚拟内存的抽象，**允许非连续的虚拟地址映射到连续的物理地址**。
- **section和segment**：人为划分的，为了更好和组织程序的代码和数据区域。
	- **section(节)**:编译器将程序中的代码和数据进行划分，以便更好进行代码优化和错误检查。例如.text .data.等这些段，用于编译和链接的阶段。
	- **segment(段)**:在可运行文件才可看到，用于创建独立的内存区域，优化内存管理，提高程序的运行效率。将具有相同属性的section合并为一个segment，由链接器执行。
	-  每个segment都会对应虚拟内存的一个区域。segment和section逻辑连续，物理内存都是分散的。
	- 段寄存器就是为了分段而存在的。
- **字节序**：当数字过大，一个字节存不下的时候。需要多个字节，这时候产生了高位是在高地址或者低地址，就产生出了字节序
	- **大端字节序**：低字节在内存高位，高字节在内存低位。符号位判断方便。**我们习惯是大端字节序。** x86,DEC大端
	- **小端字节序**：低字节在内存低位，高字节在内存高位。当强制转换数据类型不需要调整字节。IBM,Sun,PowerPC小端
	- 选大端还是小端是硬件厂商考虑的。
- **虚拟内存**：是一种将计算机硬件的物理内存和硬盘等外部存储器结合起来，形成一个比实际物理内存大的地址空间，从而为每个进程提供了一个看似连续、更大的内存空间。 ^1d9fd6
	-  **物理页(PG)**：是**物理内存（RAM）** 被划分为**固定大小块**的单位，这些固定大小的块就叫**物理页框**。**物理页框的大小就是按多大的内存来划分，常见的4kb，4mb等**。
		- **一个物理页里面存在着很多个字节，每个字节都有唯一的地址**。
	- **物理页号（PPN）**：用来标识物理页框的数值，**可以理解为索引**。
	- **物理页号偏移（PPO）**：即一个页号里面的**偏移量**。
	- **寻址也是通过物理页号+物理页号偏移来找对应的位置**
		- PPN* 每页的大小+PPO。

	- **虚拟内存**：**这里的虚拟内存和上面的虚拟内存不一样概念。** **每个程序特有，存放在磁盘上，由虚拟页组成。**
	- **虚拟地址**：程序中使用的地址，由程序生成，对应于虚拟内存。**由编译/运行时生成的，与物理地址并不对应**。
	- **虚拟页(VP)**：将一个进程的虚拟地址空间划分成固定大小的块。这些块即为虚拟页。
	- **虚拟页号**：用来标识虚拟页框的数值，**可以理解为索引**。
	- **虚拟地址空间**：每个运行中的程序所看到的内存空间，也就是程序能够使用的地址范围。每个进程在运行时都被分配了自己的虚拟地址空间，这个空间通常很大，远远超过了计算机实际物理内存的大小。**大小与位数有关，通常32位的位4GB，64位的为18.4 million TB（2^64字节）**
	
	 - **页表**：虚拟地址与物理地址的对应表集合。
		 - **多级页表**：页表的优化形式。通常结构分为**第一级页表（目录）** 和 **第二级页表（页表）**。
	 - **页表条目**：即页表里面的记录，**记录的结构和具体信息和操作系统和硬件架构有关**
	 - **快表（TLB）**：**是一个小型的高速缓存，用于存储最近访问的页表项。TLB加速了地址转换，减少了对页表的频繁访问。**
	 - **交换区（SWAP）**：用于暂时存储物理内存中数据的一部分磁盘空间。
	 - 虚拟地址寻址和物理地址寻址一样通过**页号 pagesize（页大小）+ 偏移量**来计算
	 - **MMU**：计算机中的硬件模块，负责**虚拟地址到物理地址的转换**。同时也执行内存保护、访问权限检查等功能由4个关键组件组成：
		- **地址转换**
		- **内存保护和访问权限检查**
		- **页面替换策略**
		- **页面错误处理**
	
	 - 流程如图：
		 - **页表可以找到对应的条目**
			 - ![[Drawing 2023-10-25 19.48.35.excalidraw]]
		 - **页表找不到对应条目，即缺页**
			 - ![[Pasted image 20231025195543.png]]
			 - **缺页时，程序暂停运行**
				 - MMU产生页面错误异常。
				 - 操作系统介入，内核被触发，操作系统决定如何处理异常。
					 - 页面是否合法，检查地址是否在地址空间范围内。
					 - 页面是否在磁盘，操作系统将页面从磁盘读取到物理内存。涉及I/O操作。
					 - 如果物理内存没有足够空间，要根据页面置换算法进行页的置换。
						 - 牺牲页（被置换的页）：
							 - 牺牲页被修改过，写回磁盘。
							 - 操作系统更新页表。
					- 程序重新执行引发页面错误的指令。