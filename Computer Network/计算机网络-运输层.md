- **运输层协议为运行在不同主机上的应用程序之间提供了逻辑通信**。
- **运输层协议实在端系统而不是在路由器上实现。**
- 运输层的分组叫做**报文段**。
- **运输层与网络层关系**：
	- 网络层提供了主机之间的逻辑通信。
	- 类比来说就是相当于间隔很远的两个家庭，每个家庭有12个孩子，两个家庭之间需要进行写信，每个家庭会有一个人负责收发信息（相当于运输层协议），邮政服务（相当于网络层协议）
- **运输层协议**：
	- UDP（用户数据报协议）：为调用的应用程序提供了不可靠、无连接的协议。
	- TCP（传输控制协议）：为调用的应用程序提供一种可靠，面向连接的服务。
	- 进程到进程的数据交付和差错检查是两种最低限度的运输层服务。UDP提供的仅有两种服务。
	- 在最低限度的运输层服务加上提供**可靠数据传输（relia-ble data transfer）**，通过使用**流量控制，序号，确认和定时器**TCP确保正确，按序的将数据从发送进程交付给接收进程。还提供了**拥塞控制（congestion control）**。
- **多路复用和多路分解**：
	- 多路复用：在发送端将多个不同的数据流（通常来自不同应用程序）合并成一个单一的数据流进行传输，这样可以共享网络资源，提高网络的利用率。在运输层，多路复用可以通过使用端口号来实现。每个应用程序或进程都与一个唯一的端口号相关联。当数据从这些应用程序发送时，**运输层将根据端口号将它们合并成一个数据流**，并通过网络传输到目的地。
	- 多路分解：在接收端，当数据到达目的地后，运输层需要根据端口号将数据从单一的数据流中分解出来，然后将其传递给正确的应用程序或进程进行处理。通过这种方式，运输层可以保证数据到达正确的目的地，并交付给正确的应用程序进行处理。
	- 总结起来，多路复用允许将多个数据流合并为一个数据流进行传输，而多路分解则允许在接收端将数据从单一数据流中分解出来，交付给相应的应用程序。这两个过程是运输层实现可靠数据传输的重要机制。
- UDP套接字是一个二元组全面标识的（目的IP地址和一个目的端口号）
- TCP套接字是一个四元组（源IP地址，源端口号，目的IP地址，目的端口号），这四个字段被用来将报文段定向（分解为）到相应的套接字。
- **UDP（用户数据报协议）**：
	- UDP相对于TCP有些应用程序更加适合原因：
		- 关于发送什么数据以及何时发送的应用层控制更精细。
		- 无需建立连接。
		- 无连接状态。
		- 分组首部开销小。每个TCP报文都有20字节的首部大小，而UDP只有8字节的首部大小。
	- 报文段结构：![[Drawing 2023-08-05 16.48.40.excalidraw]]
	- UDP检验和：提供了差错检测功能（但是对差错回复无能为力）。通过UDP伪头部和UDP头部以及UDP数据进行计算。进行反码运算（将所有的0换成1，1换成0）。求和遇到溢出的话会被回卷（将溢出位进位到最低位中）。
- **构造可靠数据传输协议**：
	- **有限状态机（Finite-State Machine，FSM）**：是一种数学模型和计算模型，用于描述系统在不同状态之间转换的行为。它是一种抽象的模型，用于描述具有有限个状态、转移条件和动作的系统的行为。
		- 经完全可靠信道的可靠传输：rdt1.0:
			- 在这种情况下，底层信道是完全可靠的。FSM图如下![[Drawing 2023-08-09 16.41.36.excalidraw]]
		- 经具有比特差错信道的可靠数据传输：rdt2.0：
			- 在这种情况下，底层信道分组的比特可能受损。FSM如下![[Drawing 2023-08-09 17.02.21.excalidraw]]
			- rdt2.1，ACK分组或者NAK分组存在受损的可能性。
				- ACK或者NAK分组受损，解决办法存在三种可能性
					1. 类比我们人可能做法，如果说话者不理解来自接收方回答的“OK”或者“请重复一篇”，说话者会问“你说什么”。如果说话者的“你说什么”产生了差错的话，接收者不明白那一句是什么，所以接收者会回“你说什么”。这时候就会出现一个无尽的循环。
					2. 增加足够的检验和比特，发送方不仅可以差错检测，还能恢复差错，对于不会产生差错不丢失分组的信道，可以直接解决。
					3. 当发送方收到含糊不清的ACK或NAK分组，只需重传当前数据分组即可，然而，这可能导致引出了**冗余分组（duplicate packet）**，接收方不知接收到的分组是新的还重传。
						- 解决这个问题通过让发送方对数据分组编号。分组中加入**序号**字段。接收方通过序号就可以知道是新的分组还是重传了。
					- ![[Drawing 2023-08-09 17.02.10.excalidraw]]
					- 也可以通过发送方接收到同一个分组的两个ACK（冗余ACK）判断是否正确接收分组，rdt2.2就是在具有比特差错信道上实现一个无NAK的可靠的可靠数据传输协议。这样的话就需要对ACK进行编号。![[Drawing 2023-08-10 15.41.28.excalidraw]]
		- 经具有比特差错的丢包信道的可靠数据传输：rdt3.0（比特交替协议，因为分组序号在0和1之间交替）：
			- 在这种情况下，底层信道分组比特除了受损以外，还会丢包。
			- 通过一个超时来进行重传，这个时间只要是一个往返时间和接收方处理一个分组的时间。这个就需要一个倒计数定时器。发送需要做到：
				- 每次发送一个分组（包括第一次分组和重传分组）时，启动一个定时器。
				- 响应定时器中断（采取适当动作）
				- 终止定时器。
			- ![[Drawing 2023-08-10 16.38.20.excalidraw]]
			- ![[Drawing 2023-08-10 17.13.18.excalidraw]]
- **TCP连接**：提供的是全双工的服务。