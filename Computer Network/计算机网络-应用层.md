- **网络应用程序体系结构**：有两种主流体系结构：
	- 客户-服务器体系结构：有一个总打开的主机称为服务器，用于服务其他客户的主机请求。 
	- 对等体系结构(P2P architecture)：应用程序在间断连接的主机对之间使用直接通信。这些主机称为**对等方**。
- **进程通信**：当多个进程运行在相同的端系统上时，它们使用进程间通信机制相互通信，当运行在不同端系统上的进程间的通信时，通过跨越计算机网络交换报文来进行相互通信。
- **进程与计算机网络之间的接口**：进程通过一个**套接字（socket）** 的软件接口向网络发送报文和接收报文。套接字是同一台主机内应用层和运输层之间的接口。开发者可以控制套接字在应用层的一切，但是对运输层几乎没有控制权。对于运输层控制：
	1. 选择运输层协议
	2. 设定几个运输层的参数，如最大缓存和最大报文段长度等。
- **进程寻址**：一台主机运行的进程向另一台主机运行的进程发送分组，需要两种信息
	- 主机的地址（IP地址和端口号）
	- 在目的主机中指定接收进程的标识符
- **可供应用程序使用的运输服务**：通过四个方面对应用程序服务要求进行分类：
	- 可靠数据传输：分组可能会丢失，但部分应用数据丢失会造成灾难性后果，对于这些应用程序而言。必须确保应用程序的一端发送的数据正确，完全交付给应用程序的另一端。如果提供了这样的确保数据交付，就认为提供了**可靠数据传输（reliable data transfer）**
	- 吞吐量：具有吞吐量要求的应用程序被称为**带宽敏感的应用**。可用吞吐量就是发送进程能够向接收进程交付比特的速率。
	- 定时：定时保证某些应用的时延在一定的范围内。
	- 安全性：应用数据的安全性。
- **因特网提供的运输服务**（详细介绍查看[[计算机网络-运输层]]）：
	- TCP服务：面向连接服务（需要客户和服务器互相交换运输层控制信息，即握手阶段，建立的连接时全双工的，即一个PC端可以接收和发送数据）和可靠数据传输服务（可以依靠TCP，无差错，按适当顺序交付所有发送的数据），但是在握手阶段时明文的，所以不安全，更安全的为SSL（更多内容查看[[计算机网络中的安全#^9fb303]]）
	- UDP服务:不提供不必要服务的轻量级运输协议。无连接的，提供的是不可靠数据传送服务。
- **应用层协议**：定义了运行在不同端系统上的应用程序进程如何相互传递报文，应用层协议定义了
	- 交换的报文类型，例如请求报文和响应报文。
	- 各种报文类型的语法，报文各个字段及这些字段是如何描述的。
	- 字段的语义，即这些字段中信息的含义
	- 确定一个进程何时以及如何发送报文，对报文进行响应的规则。
- **HTTP超文本传输协议**：
	- 使用TCP作为它的支撑运输协议。
	- HTTP服务器并保存关于用户的任何信息。所以说HTTP是**无状态协议**。
	- 非持续连接：请求和响应都是经过一个单独的TCP连接发送。步骤如下：
		- 假设HTML文件的URL为：http://www.someSchool.edu/someDepartment/home.index 假设该页面有一个HTML基本文件和10个JPEG图片。
		1. HTTP客户进程在端口号80发起一个到服务器的TCP连接，该端口是HTTP默认端口，在客户和服务器上分别有一个套接字与连接相关联。
		2. HTTP客户经过套接字向服务器发送一个HTTP请求报文。请求报文包含了路径名。
		3. HTTP服务器进程经过套接字接收请求报文，从存储器中检索出对象www.someSchool.edu/someDepartment/home.index，在响应报文中封装对象。通过套接字发送响应报文
		4. HTTP服务器进程通知TCP断开连接（但是直到TCP确认客户已经完全的收到响应报文为止，才会实际中断连接）
		5. HTTP客户接收响应报文，TCP连接关闭。客户端从响应报文提取文件。
		6. 对每个要请求的文件重复前四个步骤。
		- 非持续连接就是每个TCP连接在服务器发送一个对象后就关闭。不为其他对象而持续下来。
	- **往返时间（Round-Trip Time，RTT）**：指一个短分组从客户到服务器然后再返回客户所花费的时间。**RTT包括分组传播时延，排队时延，处理时延和传输时延**。在点击超链接会发生，浏览器会向服务器发起一个TCP连接。**三次握手前两次耗费一个RTT**，**第三次握手和发送HTTP请求/响应花费一个RTT**，所以通俗来讲可以说总的响应时间是两个RTT加上服务器传输HTML文件的时间。
	- 非持续连接有一些缺点：
		- 第一：必须为每一个请求的对象建立和维护一个全新的连接。给服务器带来严重负担。
		- 第二：每一个对象经受两倍RTT的交付时延。
	- 持续连接：所有的请求及响应经相同的TCP连接发送。（默认使用）
	- **HTTP报文格式**：
		- 请求报文:![[Drawing 2023-07-28 15.29.22.excalidraw]]
		- 响应报文：![[Drawing 2023-07-28 16.03.57.excalidraw]]	
- **用户与服务器的交互 cookie**：
	- cookie用来识别用户，将内容与用户身份联系起来，允许站点对用户进行跟踪。
		- 四个组件：
			- 在HTTP响应报文中的一个cookie首部行
			- 在HTTP请求报文中的一个cookie首部行
			- 在用户端系统保留有一个cookie文件
			- 服务器端的后台数据库
	- 在第一次访问新网页的时候，服务器将会给这个新用户设置cookie，然后当用户再次访问的时候就会将这个网页的cookie插入请求报文中发送出去，之后服务器就可以通过后台数据库知道该用户的身份。
- **Web缓存（Web cache）也叫代理服务器（proxy server）**：
	- 能够代表初始Web服务器来满足HTTP请求的网络实体。假设浏览器请求对象：http://www.someschool.edu/campus.gif 步骤如下：
		1. 浏览器创建一个到Web缓存器的TCP连接，并向Web缓存器中的对象发送一个HTTP请求。
		2. Web缓存器进行检查，看看本地是否存储了该对象副本，如果有，Web缓存器就向客户浏览器用HTTP响应报文返回该对象。
		3. 如果Web缓存器中没有该对象，它就打开一个与该对象的初始服务器（www.someschool.edu） 的TCP连接。Web缓存器则向初始服务器的TCP连接上发送一个该对象的HTTP请求，收到请求后，初始服务器向该Web缓存器发送具有该对象的HTTP响应。
		4. Web缓存器接收到对象之后，在本地存储空间存储一份副本，然后用HTTP响应报文发送该副本（通过之前创建的客户和Web缓存器之间的TCP连接）
	- Web缓存器通常由ISP购买并安装，Web缓存器可以大大减少对客户请求的响应时间，Web缓存器可以大大减少一个机构的接入链路到因特网的通信量。
	- **内容分发网络（Content Distribution Network，CDN）**：是一种网络架构和技术，用于优化互联网内容的传输和交付。它的主要目标是提高网站、应用程序、视频和其他在线内容的加载速度、可用性和性能。
		- 在传统的互联网访问模式中，当用户请求访问一个位于特定服务器上的网站或应用时，数据会直接从该服务器传送到用户的设备上。这可能导致以下问题：
			1. **网络延迟：** 如果用户和服务器之间的距离较远，数据传输可能需要更多的时间，导致加载速度较慢。
			2. **服务器负载：** 高流量的网站可能会导致服务器负载过重，降低服务器的响应速度。
			3. **网络拥塞：** 流量集中在某个服务器上可能导致网络拥塞，影响用户体验。
		- CDN通过在全球范围内部署位于不同地理位置的服务器节点，解决了上述问题。当您使用CDN时，它会复制您的网站或应用的内容并存储在分布式的服务器上。当用户请求访问您的网站时，CDN会根据用户的地理位置和网络条件，选择距离用户最近的服务器节点来提供内容。
		- CDN的优势包括：
			1. **快速加载时间：** 由于内容存储在距离用户更近的服务器上，加载时间大大减少。
			2. **减轻原始服务器负载：** CDN分担了原始服务器的流量，降低了其负载，有助于提高其性能和可靠性。
			3. **抵御流量峰值：** 当某个内容在全球范围内变得流行时，CDN可以有效地处理流量峰值，确保用户始终能够快速访问内容。
			4. **提高全球访问性：** 用户从不同的地理位置和网络条件下访问内容时，都能够获得更好的体验。
		- CDN通常由专业的服务提供商管理，网站所有者或内容提供商可以通过将其内容接入CDN来改善用户体验。常见的CDN提供商包括Akamai、Cloudflare、Amazon CloudFront等。
		- 总之，CDN是通过在全球范围内分布内容节点来加速和优化网络内容交付的技术，它对于提高网站和应用程序的性能和可用性至关重要。
	- **条件GET方法**：Web缓存能可以大大减少对客户请求的响应时间，Web缓存器可以大大减少一个机构的接入链路到因特网的通信量。但是存在一个问题，即存放在缓存器的对象副本是旧的，这个**条件GET方法**可以允许缓存器证实它的对象是最新的。
		1. **请求报文使用GET方法**
		2. **请求报文中包含一个首部行 If-Modified-Since：**
		- 满足以上两个条件就是 **条件GET方法**。
- **因特网中的电子邮件**：
	- 因特网电子邮件系统和关键组件：
		- **用户代理**：允许用户阅读，回复，转发，保存和撰写报文。
		- **邮件服务器**：包含以下主要组件和功能：
			- **邮件代理（Mail Transfer Agent，MTA）： 邮件代理是邮件服务器的一个重要组件，负责在因特网上传递电子邮件。有两种主要类型的邮件代理：**
				- **出站邮件代理（Outgoing MTA）**：负责处理发件人发送的电子邮件，将邮件传递给接收方的邮件服务器。
				- **入站邮件代理（Incoming MTA）**：负责接收外部发来的邮件，并将邮件存储在收件人的邮箱中。
			- **邮件存储系统**： 邮件服务器需要一个邮件存储系统，用于保存接收到的电子邮件。这个存储系统通常是一个数据库或文件系统，以便可靠地保存和管理用户的电子邮件。
			- **用户代理（Mail User Agent，MUA）接口**： 邮件服务器提供与用户代理（例如电子邮件客户端或Web邮件客户端）进行通信的接口。通过这个接口，用户可以查看已收到的邮件、发送新邮件和管理自己的邮箱。
			- **电子邮件协议支持**： 邮件服务器支持各种电子邮件协议，以便不同类型的邮件客户端可以与它进行通信。常见的电子邮件协议包括：
				- POP3（Post Office Protocol version 3）：用于从服务器下载电子邮件到本地设备。
				- IMAP（Internet Message Access Protocol）：允许在邮件服务器上直接管理邮件，包括文件夹、标记、已读状态等。
				- SMTP（Simple Mail Transfer Protocol）：用于发送电子邮件。
			- 身份验证和安全性： 邮件服务器通常要求用户进行身份验证，以确保只有授权用户可以访问自己的邮箱。此外，邮件服务器也需要实施各种安全措施，以防止垃圾邮件、病毒、恶意软件和其他网络攻击。
			- 邮件过滤和防垃圾邮件功能： 为了减少垃圾邮件对用户的干扰，邮件服务器通常配备了邮件过滤和防垃圾邮件功能。这些功能可以帮助自动识别和过滤垃圾邮件，确保用户只接收到有价值的邮件。
			- 邮件备份和恢复功能： 为了确保邮件数据的安全和可靠性，邮件服务器可能实施定期的备份策略，以便在需要时能够快速恢复数据。
			- **报文队列**：在发送的时候会经过报文队列，这个报文队列也会存储不能交付的邮件(会重新发，如果几天都不能成功的话，就会删除掉这个不能交付的邮件)
		- **简单邮件传输协议(Simple Mail Transfer Protocol,SMTP)**：用于从发送方的邮件服务器发送报文到接收方的邮件服务器，但因为比较陈旧所以会存在一些古老的限制：限制所有邮件报文的部分只能采用简单的7比特ASCII表示，所以在接收的时候也需要对内容进行解码为多媒体数据。
			- 传输过程如下：
				1. Alice调用她的邮件代理程序并提供Bob的邮件地址，撰写报文，然后指示用户代理发送该报文。
				2. Alice用户代理把报文发送她的邮件服务器，并在服务器里将报文放入报文队列中。
				3. 运行在Alice的邮件服务器上的SMTP的客户端发现了报文队列中的这个报文，创建一个到运行在Bob的邮件服务器的SMTP服务器的TCP连接。
				4. 在经过握手后，SMTP客户通过TCP连接发送Alice的报文
				5. 在Bob的邮件服务器上，SMTP的服务器端接收该报文，Bob的邮件服务器然后将报文放入Bob的邮箱中。
				6. 在Bob方便的时候，调用用户代理阅读该报文。
			- SMTP一般不使用中间邮件服务器发送邮件，即使这两个邮件服务器很远。也不在中间的某个邮件服务器存留。
			- SMTP用于从发送方的邮件服务器传输到接收方的邮件服务器，同时也用于将邮件从发送方的用户代理传送到发送方的邮件服务器。
		- SMTP与HTTP比较：
			- 相同
				- 两个协议都是用于从一台主机向另一台主机传送文件
				- 都是使用持续连接
			- 不同
				- HTTP是拉协议，HTTP从服务器拉取数据，TCP连接是想接收文件的机器发起的。SMTP是推协议，发送邮件服务器把文件推向接收邮件服务器，TCP连接由要发送文件的机器发起的。
				- SMTP要求每个报文采用7比特的ASCII码格式。HTTP没有这个限制。
				- 两者处理一个既包含文本又包含图形的文档，HTTP把每个对象封装到它自己的HTTP响应报文中。SMTP将所有报文对象放在一个报文之中。
		- 从ISP的邮件服务器上获取邮件协议，第三版的邮局协议（Post Office Protocol-Version 3，POP3），因特网邮件访问协议（Internet Mail Access Protocol，IMAP）以及HTTP
			- **POP3**：运行在端口110的TCP连接上，POP3分为三个阶段进行工作
				- **特许（authorization）**：用户代理发送（明文方式）用户名和口令鉴别用户。
				- **事务处理**：用户代理取回报文，在这个阶段用户代理可以做删除标记，取消报文删除标记以及获取邮件的统计信息。
				- **更新**：客户发出quit命令后，目的是结束POP3会话，这时，邮件服务器删除那些被标记为删除的报文。
				- 但是POP3存在一些缺点，
					1. **单一设备访问**：POP3是一种单一设备访问的协议，这意味着它只能在一个设备上下载和管理邮件。如果你使用多个设备（例如台式电脑、笔记本电脑、手机等）来查看邮件，你需要在每个设备上单独下载邮件。这样可能会导致邮件不同步的问题，造成不便。
					2. **邮件下载**：POP3协议的基本行为是将邮件从服务器下载到本地设备，然后从服务器上删除邮件。这意味着邮件仅存储在本地设备上，一旦设备出现故障或邮件丢失，将无法从其他地方恢复邮件。
					3. **无法在线管理邮件**：由于POP3协议下载邮件到本地设备并删除服务器上的副本，因此你无法在服务器上管理邮件，例如创建文件夹、标记为已读或未读等。所有这些操作只能在本地设备上完成，这对于需要在线管理邮件的用户来说可能是一个限制。
					4. **安全性问题**：POP3最初设计时并未考虑到加密的需求。通常，POP3在认证阶段使用明文传输密码，这使得密码容易被截获。虽然现代的POP3实现通常支持加密（例如通过SSL或TLS），但并不是所有邮件服务器都支持它，这可能导致安全性问题。
					5. **不支持邮件同步**：POP3协议本身不支持邮件同步功能。这意味着如果你在一个设备上读取或删除邮件，这些更改不会自动反映到其他设备上，因为邮件仅存储在每个设备的本地。
					6. **占用服务器存储空间**：由于POP3将邮件下载到本地设备并从服务器删除，邮件服务器上的存储空间将不断增加。这可能导致服务器存储不足的问题，尤其是对于那些只有有限存储资源的邮件服务器。
			- **IMAP**：IMAP允许用户在多个设备上实时同步邮件，并在邮件服务器上管理邮件。IMAP是更现代和功能更强大的电子邮件协议之一，广泛用于电子邮件客户端与邮件服务器之间的通信。以下是IMAP协议的一些主要特点：
				1. **邮件同步**：IMAP允许用户在多个设备上同步邮件。当你在一个设备上读取、删除或标记邮件时，这些操作会实时反映到其他设备上，使得你在任何地方都能看到相同的邮件状态。
				2. **在服务器上管理邮件**：IMAP允许你在邮件服务器上管理邮件，如创建、删除、移动文件夹，标记为已读或未读等操作。这样，你可以在不同的设备上访问和管理邮件，而不会影响邮件的状态和存储位置。
				3. **邮件保留**：IMAP默认情况下将所有邮件保留在邮件服务器上，直到你主动删除或移动邮件。这使得你可以在不同设备上访问所有历史邮件，而不必担心邮件丢失或局限于本地设备存储空间。
				4. **邮件状态**：IMAP可以跟踪邮件的状态，包括已读、未读、已回复等。这些状态信息保存在服务器上，使得你在不同设备上查看邮件时，邮件状态保持一致。
				5. **邮件部分下载**：IMAP支持部分下载，你可以选择只下载邮件的头部信息或部分内容，而不是整个邮件。这有助于节省带宽和加快邮件下载速度。
				6. **安全性**：现代的IMAP实现通常支持SSL或TLS加密，确保邮件在传输过程中的安全性，防止被非法截获或篡改。
			- **基于Web的电子邮件**：越来越多的用户使用Web浏览器进行收发电子邮件，这时候用户代理就是浏览器，用户和远程邮箱是通过HTTP进行通信，访问一个报文的时候也是通过HTTP协议进行传输的。但是，发送方的邮件服务器与其他邮件服务器之间发送和接收邮件，依然使用SMTP。
- **DNS（因特网的目录服务）**：将主机名转换为IP地址的应用层协议。
	- 主机名:www.google.com   www.baidu.com ,这种类型是主机名。
	- IP地址：192.168.0.1  127.0.0.1 这种类型的是IP地址。
	- 主机名便于记忆也乐于被人们接受，而路由器只能识别定长，有着层次结构的IP地址。DNS就是将主机名转换为IP地址的协议。
	- DNS：
		- 一个由分层的**DNS服务器（DNS server）** 实现的分布式数据库。
		- 一个让主机能够查询分布式数据库的应用层协议。
		- DNS服务器通常是运行BIND（开源的DNS协议的实现）软件的UNIX机器。
		- DNS协议运行在UDP上，使用53端口。
	- DNS过程：假设浏览器请求 URL：www.someschool.edu/index.html 
		- 同一台用户主机运行着DNS应用的客户端
		- 浏览器从上述URL中抽取出主机名 www.someschool.edu ，并将这台主机名传给DNS应用的客户端。
		- DNS客户端向DNS服务器发送一个包含主机名的请求。
		- DNS客户最终会收到一份回答报文，其中含有对应于该主机名的IP地址。
		- 浏览器接收到来自DNS的IP地址，它能够向位于该IP地址80端口的HTTP服务器进程发送一个TCP连接。
	- DNS除了进行主机名到IP地址转换外，还提供了一些重要的服务：
		- **主机别名（host aliasing）**：主机能拥有一个或者多个别名，relay1.west-coast.enterprise.com 主机，可能还有另外别名 enter-prise.com和 www.enterprise.com  在这种情况中，relay1.west-coast.enterprise.com 也称为**规范主机名（canonical hostname）** 应用程序可以调用DNS来获得主机别名对应的规范主机名以及主机IP地址。
		- **邮件服务器别名（mail server aliasing）**： Bob的邮件地址像 bob@yahoo.com 简单，然而雅虎邮件服务器的主机名可能更复杂，不好记，这时候电子邮件应用程序可以调用DNS对提供的主机别名进行解析获得主机的规范主机名及IP地址。事实上，MX记录允许一个公司的邮件服务器和Web服务器使用相同的主机名。
		- **负载分配（load distribution）**：DNS也用于冗余的服务器之间进行负载分配，给同一个域名指向不同的IP地址，DNS服务器根据地理位置或者权重为用户返回不同的IP地址。通常用于大型的视频，游戏网站，单台服务器无法满足正常请求。
	- DNS的存在给因特网应用带来了额外的时延，所以我们需要使用缓存技术来降低时延。
	- DNS工作机理：简单的设计就是因特网只用一个DNS服务器，包含所有的映射。但是存在以下问题：
		- **单点故障（a single point of failure）**：如果DNS服务器崩溃，整个因特网随之瘫痪。
		- **通信容量（traffic volume）**：单个DNS服务器不得不处理所有的DNS查询（为上亿台主机服务）。服务器压力大
		- **远距离的集中式数据库（distant certralized database）**：对于离DNS服务器较远的地区，导致严重的时延。
		- **维护（maintenance）**：单个DNS服务器不得不为所有的因特网主机保留记录，数据库过于庞大，而且不得不为解决每个新添加的主机进行频繁更新。
	- 根据以上问题，DNS采用分布式的设计方案。以层次方式组织。
		- 分为三种类型的DNS服务器:
			- 根DNS服务器：提供TLD服务器的IP地址
			- 顶级域（Top-level Domain，TLD）DNS服务器：类似com,org,edu和gov等这样的域名，TLD服务器提供权威DNS服务器的IP地址。
			- 权威服务器：类似facebook.com，baidu.com这样的服务器的地址。
			- 本地DNS服务器：这个本地DNS服务器并不属于该服务器的层次结构。每个ISP都有一台本地DNS服务器。
		- 为了改善DNS查询的时延，运用了DNS缓存。
			- 本地DNS服务器可以把之前查询的映射在本地存储器中，当主机重新查询的时候，如果本地DNS服务器中有缓存的话就直接返回IP地址，如果没有则向根DNS服务器发送DNS查询报文。这个缓存并不是永久的，在一段时间后丢弃缓存的信息。
		- DNS记录：四元组（Name，Value，Type，TTL）。
			- TTL是该记录的生存时间，决定记录应当何时在缓存中删除。
			- Name，Value两值取决于Type
				- Type=A，Name为主机名，Value为对应的IP地址。
				- Type=NS，Name是个域，Value是如何获得该域中主机IP地址的权威DNS服务器的主机名。
				- Type=CNAME，Value是别名为Name的主机对应的规范主机名。该记录能够向查询的主机提供一个主机名对应的规范主机名。
				- Type=MX，Value是个别名为Name的邮件服务器的规范主机名。
		- DNS报文：![[Drawing 2023-08-02 16.03.20.excalidraw]]
		- DNS数据库插入记录：
			- 要向注册登记机构注册域名。（注册登记机构验证域名的唯一性，并将该域名输入DNS数据库）
			- 向注册登记机构注册域名时，假设域名为（networkutopia.com），要向机构提供你的基本和辅助权威DNS服务器的名字和IP地址。
		- DNS是因特网基础设施至关重要的组件，DNS会存在被攻击的可能性。
			- 第一种方式是分布式拒绝服务（DDoS）带宽洪范攻击，攻击者通过试图向每个DNS根服务器发送大量分组，让合法DNS请求得不到回答。
			- 更有效的DDoS攻击是向顶级域名服务器发送大量的DNS请求，但是这种请求可以通过本地DNS服务器的缓存可以缓解。
			- 是通过中间人攻击，攻击者截获主机的请求并返回伪造的回答。
			- DNS毒害攻击，攻击者向一台DNS服务器发送伪造的回答。诱使服务器在它的缓存中接收伪造的记录。
			- 后二者攻击都可以重定向Web站点，但是很难实现，因为要求要截获发往DNS的分组和遏制住服务器。
- **P2P文件分发**：P2P体系结构对服务器有最小或者没有依赖，成对的主机彼此之间直接通信。每个对等方能够向任何其他对等方重新分发它已经收到的该文件的任何部分，在分发过程中协助该服务器。最为流行的P2P分发协议是BitTorrent。