- **控制平面**：控制沿着源主机到目的主机的端到端路径之间的路由器如何转发数据包，还控制网络层组件和服务如何配置和管理。
- **路由选择算法**：确定一条从发送方到接收方的路径。
	- 通过算法是否集中分类：
		- **集中式路由选择算法**：在计算之前要知道所有链路上的信息，每个节点都有完整的网络拓扑信息。
			- **链路状态路由选择算法（LS算法）**：
				- 通过**链路状态广播算法**向网络上的所有节点广播自己状态信息，链路状态和连接到的链路状态
				- 每个节点通过收集到的数据对链路状态的**数据库进行构建**
				- **节点之间互相交换信息**。
				- **Dijkstra算法**（参见数据结构图结构中的最短路径）进行最短路径的计算
				- **路由表建立与维护**
				- **数据包转发**
		- **分散式路由选择算法**：不需要知道全局信息，只需要知道邻近节点的信息就可以通过迭代，分布式的方式计算出最低开销路径。每个节点通常只有邻居节点的信息。
			- **距离向量选择算法（DV算法）**：
				- **初始化**：每个路由器只知道邻居节点信息，对于其他节点信息设置为无穷大。
				- **距离向量更新**：当链路状态发生变化，路由器会发送自己的距离向量给邻居节点。这个信息包含了路由器所知道的到达所有目标节点的距离。
				- **距离向量表接收**：路由器接收来自邻居节点的距离向量信息，并将其存储在自己的距离向量表中。
				- **距离计算**：路由器使用Bellman-Ford算法进行计算最短路径。
				- **路由表建立与更新**。
				- **数据报转发**
				- **距离向量周期性更新**：距离向量算法通常有周期性的更新，路由器定期发送距离向量信息给邻居，以确保信息的实时性。此外，也会有触发更新，当检测到链路状态发生变化时，立即触发更新以加速收敛。
				- **路由循环检测**：距离向量算法中容易发生路由环路问题，因此需要实施路由循环检测机制。一种常见的方法是使用**毒性逆转（poison reverse）或拆分-合并（split-horizon）** 等技术来避免路由环路。
	- 通过算法是静态还是动态：
		- **静态路由选择算法**：路由随时间变化非常缓慢，人工进行调整。
		- **动态路由选择算法**：随着网络流量负载或拓扑发生变化而改变路由选择路径。
	- 通过是否负载敏感（指的是系统在处理不同负载水平或工作负荷下的表现和响应能力。）：
		- **负载敏感算法**：其性能和行为取决于系统的负载水平。这些算法通常设计成在不同的负载条件下表现出不同的行为。
		- **负载迟钝算法**：它指的是在高负载或负载增加时，系统或算法的响应时间变得缓慢或延迟。
- **自治系统内部的路由选择（OSPF）**：
	- **自治系统（Autonomous System，AS）**：每个ISP都有自己的路由器网络，自己可以定义运行规则（路由选择算法等）。
		- **相同的AS的路由器运行相同的路由选择算法并且拥有彼此的信息。**
		- 在一个自治系统运行的路由选择算法是**自治系统内部路由选择协议（intra-autonomous system routing protocol）**
		- OSPF路由选择和IS-IS广泛用于因特网的AS内部路由选择。
			- OSPF使用洪泛链路状态信息和Dijkstra最低开销路径算法。
			- 洪泛：一种广播或传播信息的方法。过程如下
				1. **初始化**：一个节点（发件人或路由器等）初始化，该节点希望将信息广播。
				2. **信息创建**：创建需要广播的信息。
				3.  **发送**：起始节点开始发送信息到相邻节点，通过直接物理连接或网络协议通信。
				3. **节点接收**：邻居节点接收到后，执行两步
					- **检查重复**：检查是否处理过，避免重复处理。
					- **处理**：信息如果是新的或者还没处理的，节点执行所需操作，继续发送信息给除了发送者外的邻居节点。
				4. **重复**：重复第三步。
				5. **结束**：网路中的节点全部收到就结束了。
			- **OSPF优点**：
				- **安全**：能够鉴别OSPF路由器之间的交换。之间的报文可以进行加密。
				- **多条相同开销的路径**：当到达某目的地的多条路径有相同的相同的开销，OSPF允许使用多条路径进行转发报文。
				- **对单播和多播路由选择的综合支持**。
				- **支持在单个AS中的层次结构**。
-  **BGP边界网关协议（ISP之间路由选择，AS之间的路由选择协议）**：可以理解为AS之间的网关。用于在不同的自治系统（AS）之间传输路由信息和控制路由策略。
	- 在边界路由器中，转发表是具有形式为（x，I）的表项，x为前缀（138.16.68/22），I为路由器接口之一的接口号。
	- 边界路由器是通过与另一个AS中的边界路由器之间交换信息知道IP地址的前缀，边界路由器的策略可以人工进行配置。
	- 边界路由器同时还需要运行BGP路由选择，需要以最低的开销到达下一个路由。
	- **网关路由器**：AS内部中边界的路由器
	- **内部路由器**：与网关路由器相反。
	- **BGP连接**：每对路由器通过端口179半永久TCP连接交换路由选择信息。每条直接连接以及所有通过该连接发送的BGP报文，就是**BGP连接**。
	- **外部BGP**：跨越两个AS的BGP连接称为**外部BGP**
	- **内部BGP**：在相同AS中的两台路由器之间的BGP会话为**内部BGP**
	- **BGP属性**：路由信息中包含的各种字段或值，用于描述路由的特征、特性和路径信息。
		- **AS-PATH**：是个列表，路由信息所经过的每个AS的编号。
		- **NEXT-HOP**：数据包应该通过哪个IP地址或接口进行转发，以到达目的地网络。
		- **前缀（Prefix）**:目标网络的IP地址范围
		- **本地首选路径（local preference）**：在同一个AS中选择最佳路径
		- **权重（weight）**：特定设备的属性，本地路由器选择最佳路径
		- **出口策略（Outbound Policy）**：本地路由器应该将哪些路由信息传播到邻接AS。
		- **社区（community）**：将BGP路由标记为特定社区或群组，以便于策略控制和路由筛选。
		- **原始路由（Origin）：** 指示了路由信息的来源，可以是IGP、EGP或手动配置。
		- **多路径（Multipath）：** 多路径属性允许在BGP路由选择中使用多个相等的路径，提高路由冗余和负载均衡。
		- **MED（Multi-Exit Discriminator）：** MED属性用于在不同AS之间选择最佳出口点，具有较低MED值的路径通常被优先选择。
		- **路由聚合（Route Aggregation）：** 路由聚合属性允许将多个前缀合并成一个更大的前缀，以减小路由表的大小。
		- **可达性（Reachability）：** 可达性属性描述了目的地网络的可达性状态。
		- BGP路由选择算法：
			- 热土豆路由选择：尽可能块地将分组送出其AS（最低开销），而不担心其AS外部到目的地的余下部分的开销。当在转发表中增加AS向外前缀时，AS间路由选择协议BGP和AS内部路由选择协议如OSPF都要用到
			- 路由选择算法：
				- 路由被指派一个本地偏好，具有最高本地偏好的路由将被选择。
				- 选择最短的AS-PATH路由。
				- 选择具有最靠近NEXT-HOP路由器的路由。
				- BGP标识符选择路由。
		- **IP任播**：BGP还可以使用在IP任播上，在内容分发网（CDN）中。
- **SDN控制平面（SDN相当于新架构）**：控制分组在网络的SDN设备（分组交换机）中转发的网络范围逻辑。
	- SDN体系结构组件：![[Drawing 2023-09-15 16.43.17.excalidraw]]
	- SDN体系结构有4个关键特征：
		- **基于流的转发**：可以基于运输层，网络层或者链路层首部任意字段进行转发。
		- **数据平面和控制平面分离**：控制平面负责计算数据报的导向，由服务器以及决定和管理交换机流表的软件组成。
		- **网络控制功能**：可以通过多个服务器集群去管理网络
		- **可编程的网络**：通过运行在控制平面上的应用程序进行管理网络，对SDN控制器提供API。
	- **SDN控制器组成**：
		- **通信层**：SDN控制器和受控网络设备之间的通信，传送控制器与设备之间的信息（即openflow）
		- **网络范围状态管理层**：这一层主要负责管理整个网络的状态信息，包括网络拓扑、流量工程、链路状态等。
		- **对于网络控制应用程序层的接口**：这一层是SDN架构中的顶层，包括各种网络控制应用程序，例如负载均衡、安全策略管理、流量工程等。
	- **openflow协议**：运行在TCP之上，使用6653的默认端口，从控制器到受控交换机重要报文有下列这些：
		- **配置**：报文允许控制器查询并设置交换机的配置参数
		- **修改状态**：增加/删除或修改交换机流表的表项，并设置交换机端口特性。
		- **读状态**：被控制器用于从交换机的流表和端口收集统计数据和计数器值。
		- **发送分组**：被控制器用于在受控交换机从特定的端口发送出一个特定的报文
		- **流删除**：该报文通知控制器已删除一个流表项。
		- **端口状态**：交换机用该报文向控制器通知端口状态的变化
		- **分组入**：分组到达交换机端口，并且不能被流表项所匹配，这时分组被发送到控制器进行额外处理。匹配的分组也发送给控制器。作为匹配所采取的动作，**分组入**被用于将分组发送给控制器。
	- 举例：![[计算机网络-控制平面 2023-09-15 17.13.28.excalidraw]]
	- 在这个Dijkstra算法作为一个单独的程序执行，位于分组交换机的外部
	- 分组交换机向SDN控制器发送链路更新并且不互相发送
	- 步骤详解（如果s1和s2断开了）：
		- 交换机s1发现了与s2之间的链路故障，使用OpenFlow中“**端口状态”报文**向SDN控制器通报链路状态的更新。
		- SDN控制器接收指示链路状态更新的OpenFlow报文，通告**链路状态管理器**，并更新。
		- 实现Dijkstra链路状态路由选择的**网络控制应用程序**先前进行注册，链路状态更新时得到通告，应用程序接收该链路状态更新的通告。
		- **链路状态路由选择应用程序**与**链路状态管理器**相互作用，得到更新的链路状态。同时参考状态管理层的其他组件，计算新的最低开销路径
		- **链路状态路由选择应用**与**流表管理器**交互，流表管理器更新流表。
		- 流表管理器使用openflow更新受影响的节点的流表项。
- **ICMP：因特网控制报文协议**：主机和路由器之间彼此交换网络层信息。**最典型用途为差错报告（当运行HTTP会话时，可能遇到目的网络无法到达的的错误报文，因为路由器（参见网络层-数据平面）无法找到对应的主机，所以路由器就会向主机生成并发送ICMP报文指示错误）**。ICMP报文类型有个规定的表（详细的可以网上查找）。
- **网络管理和SNMP**：网络管理相当于包括硬件，软件和人类元素的设置，综合和协调。以监视，测试，轮询，配置，分析，评价和控制网络及网元资源。用合理的成本满足实时性，运营性能和服务质量的要求。
	- 网络管理框架：
		- **管理服务器（managing server）**：是一个应用程序，并运行在网络运营中心（NOC）的集中式网络管理工作站上。管理服务器是执行网络管理活动的地方。控制网络管理信息的收集，处理，分析和/或显示。
		- **被管设备（managed device）**：是网络装备的一部分（包括软件），被管设备可以是主机，路由器，交换机，中间盒，调制解调器或其他联网设备等。一个设备中有几个所谓的**被管对象（managed object）**：（被管对象是被管设备中硬件的实际部分（网络接口卡等等））
		- **管理信息库（Management Information Base，MIB）**：一个被管设备中的每个被管对象的关联信息收集到**管理信息库**。可以是一个计数器，也可以是IP数据报首部差错而由路由器丢弃的IP数据报的数量，或者是一台主机接收到的UDP报文段的数量等等。
		- **网络管理代理（network management agent）**:每个被管设备都有，是一个运行在设备上的进程（与管理服务器通信，在管理服务器的命令和控制下被管设备中采取本地动作）。
		- **网络管理协议（network management protocol）**：运行在管理服务器和被管设备之间，允许管理服务器查询被管设备的状态，并经过其代理间接地在这些设备上采取行动。代理可以通过网络管理协议向管理服务器通知异常事件。
	- **简单网络管理协议**：是一个应用层协议，用于在管理服务器和代表管理服务器执行的代理之间传递网络管理控制和信息报文。是请求响应模式。
		- SNMP管理服务器向SNMP代理发送一个请求
		- 代理收到请求之后执行某些动作，然后对该请求发送一个回答。
		- 请求通常用于查询和修改**被管设备**关联的MIB对象值。
		- SNMP第二个常被使用的是代理向管理服务器发送一种非请求报文，这个报文叫做**陷阱报文（用于通知管理服务器，一个异常情况（例如一个链路接口启动或关闭已导致了MIB对象值的改变））**。
		- SNMPv PDU类型的报文表：![[Drawing 2023-09-15 23.31.51.excalidraw]]
		- SNMP PDU格式：![[Drawing 2023-09-15 23.32.21.excalidraw]]
		- PS：SNMP演变了3个版本，以上介绍的是第二个版本的，SNMPv3在二的基础上附加上了安全性和管理能力，因为缺少安全性才导致SNMP用于监控而不是控制