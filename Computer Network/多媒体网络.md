- **多媒体网络应用**：任何应用音频或视频的网络应用
	- 视频特点：
		1. 视频的高比特率
		2. 可以被压缩，即清晰度
	- 音频性质：
		- 转化过程（脉冲编码调制（PCM））：
			1.  以某种固定的速率采样（每秒多少个样本），每个采样值都是一个任意的实数。
			2. 每个采样值四舍五入，这个过程叫做量化
			3. 量化值由固定数量比特表示，假设256个量化值，每个值用一个字节表示。
		- PCM编码的语音和音乐很少实际运用，取而代之的是MP3。另一种的标准是高级音频编码（AAC）
	- 应用类型（分三种）：
		- 流式存储音频和视频（播放视频，边播放边下载）： 
			- 特点：
				1. 流：客户接收到文件几秒后就开始播放视频，避免播放前要先下载整个视频 
				2. 相互作用：用户可以对多媒体内容进行暂停，前进，后退
				3. 连续播放：一旦视频开始播放，要根据初始记录的时序进行。
			- 三种类型：
				- UDP流：维持两个连接，一个用于传输视频流，另一个用于单独的控制连接（暂停，重新开始，重定位等），但是有三个缺点
					 1. 服务器和控制之间可用带宽无法预测且变化，恒定速率不能够提供连续播放。
					 2. 对每个进行中的客户会话处理客户到服务器的交互请求和跟踪客户状态。
					 3. 大部分防火墙配置为阻塞UDP流量，导致无法传输。
				- HTTP流：视频作为一个特定的URL的普通文件存储在HTTP服务器上。客户与服务器建立TCP连接，客户发送GET请求，服务器尽快的在响应报文发送视频文件。因为TCP的拥塞控制和重传机制的优点，HTTP也是视频可以穿越防火墙和NAT（常常被配置为阻挡UDP流量）如今的大多数流式视频应用都是用HTTP流。
					- 预取视频：因为客户端存在着缓存，客户能够尝试以高于消耗速率下载视频，预取将来会被消耗的帧。
					- 客户应用缓存和TCP缓存：一个满的客户应用缓存间接地对服务器到客户能够发送的视频速率施加了一个限制。
					- 流式视频分析：对应用的消耗速率和传输到缓存的速率进行分析，当服务器发送速率小于视频的消耗速率，客户缓存绝对不会满，但是会存在着播放到一定时候会停滞。当服务器发送速率大于视频的消耗速率的时候，在初始缓存时延后，用户将享受连续的播放直到结束。
					- 视频的早期中止和重定位：重定位的时候，客户端会发送一个新HTTP请求，用HTTP字节范围首部进行特定范围的字节请求。当进行重定位的时候，因为存在着缓存，如果重定位的位置大于缓存的字节的话，那么缓存中的字节将会被浪费，这时候会浪费带宽和服务器的资源。
				- 适应性HTTP流：根据带宽的大小发送不同的版本。相当于根据带宽大小发送不同清晰度的视频。
		-  会话式IP语音/视频：
			- 并不是时延敏感的，可以小于150ms的时延是不存在问题的。
			- 容忍丢包。
			- IP语音（VoIP）：提供尽力而为的服务，因为存在着丢包，大多数分组是没有相同的端到端时延。接收方就要判断，什么时候播放一个块，如何处理一个丢失块。
				- 丢包原因：在传播路径中，中间存在着一个或多个路由器的缓存是满的。
				- 端到端时延：路由器传输，处理和排队时延，链路传输时延和端系统的处理时延。
				- 分组时延抖动：即每个分组的路由器排队时延不一样。
					- 解决方法：序号，时间戳，播放时延消除。
				- 时间戳：发送方用每个块产生的时刻为它加上时间印记。
				- 播放时延：在这个播放时延内，大多数分组都可以到达。
					- 固定播放时延：在接收方接收到的时候在q ms后播放。如果在播放前，大多数分组可以到达就不会存在问题。
					- 适应性播放时延：估计网络时延和网络时延的变化。
				- 处理一个丢失块：
					- 前向纠错：给初始分组增加冗余信息。
					- 交织：将相邻单元在传输中以一定距离分离开。
					- 差错掩盖：为丢失分组产生一个初始分组类似的替代物。
				- 实时会话式应用的协议
					- RTP：媒体块和RTP首部一起就是一个RTP分组，是一个传输层协议。通过UDP报文段来封装RTP分组。
						- RTP不提供任何机制来确保数据的及时交付。
						- RTP不提供其他服务质量保证，甚至不保证分组的交付，防止分组的失序交付。
						- 首部字段如下图：![[Drawing 2023-07-22 11.06.46.excalidraw]]
					- SIP(会话发起协议)：
						- 提供了可以经过IP网络创建呼叫的机制，允许主叫者通知被叫者要开始呼叫，允许参与者约定媒体编码，也允许参与者结束呼叫。
						- 提供了主叫者确定被叫者的当前IP地址的机制。
						- 提供了呼叫管理的机制，包括改变编码，邀请新的参与者，增加媒体流等。
						- 过程如下：![[Drawing 2023-07-22 14.51.07.excalidraw]]
						- 关键特性：
							- SIP是一个带外协议，发送和接收SIP报文使用不同于发送和接收媒体数据的套接字。
							- 报文是一个ASCII，与HTTP报文类似。
							- SIP要求所有报文都要确认，因此可以在UDP和TCP上运行。
						- SIP地址：可以运用类似电子邮箱一样的url，例如 sip：bob@domain.com 的地址。
						- 在现实生活中，我们只能知道SIP地址，因为DHCP的存在，我们没办法知道IP地址。所以我们的INVITE报文需要先发送给SIP代理。用SIP回答响应，该响应包含 bob@domain.com 的正在使用的设备的IP地址，也有可能是Bob的语音信箱的IP地址。
						- SIP用户都有一个相关联的注册器，在发起SIP应用时，应用发送注册器一个SIP注册报文。通知注册器它现在的IP地址。过程如下图：![[Drawing 2023-07-22 16.44.50.excalidraw]]
		- 流式实况音频/视频（直播）：需要提供大于该视频消耗速率的平均吞吐量。  
	- 支持多媒体应用的三种网络层方法：
		- 尽可能利用尽力而为服务（无处不在，复杂性最小）：
			- 公平处理所有的流量
			- ISP提供充足的链路带宽，相当于要多少就给多少带宽。但是用户是否愿意向ISP支付足够多的费用？ISP愿意合作确保端到端路径被适当的定制？优化如下：
			- 将流量划分为多种类型，为不同类型的流量提供不同等级的服务。需要对每个类型的分组赋予不同的优先级，根据优先级进行速度的划分，需要有流量监管，每种类型的流量不可以越界。
			- 链路调度规则：选择在链路上传输的排队分组的方式
			- 流量监管哪些方面：
				- 平均速率
				- 峰值速率
				- 突发长度
			- 漏桶机制：分组向网络传输之前，必须在令牌桶中去除一个令牌，如果桶是空的，则必须等待。
			- 漏桶+加权公平排队（WFQ见计算机网络-数据平面）
		- 区分服务（某些，复杂性中等）：
			- 不同类型的流量处理不同
			- 因特网区分服务（Diffserv）体系结构：
				- 在分组经过第一个Diffserv的路由器或者在产生流量的Diffserv主机，分组会被标记（通过将IPV4和IPV6分组首部的区分服务（DS）字段被设置为某个值，这个区分服务（DS）字段相当于类型字段（IPV4）和流量类型字段（IPV6）），分组得到标记在核心网络得到不同的服务。
				- 核心功能：转发，当标记分组到达一个路由器时，根据与分组类型相关的所谓**每跳行为（PHB）**，分组转发到下一跳。每跳行为影响在竞争流量类型之间共享路由器缓存和链路带宽的方式。
				- PHB分为两种：
					- 加速转发，规定一类流量离开路由器的速率必须等于或者大于某个已经配置的速率。
					- 确保转发：将流量分为四类，每个类都确保提供某种最小数量的带宽和缓存。
		- 每连接服务质量（Qos）保证（很少，复杂性高）：
			- 每个源到目的地流处理不同
			- 如果存在着两个应用不能同时满足的情况，一个应当被阻塞，另一个正常连接。
			- 资源预留：一旦预约了这些资源，例如带宽之类的，则不会去理会其他的呼叫需求。
			- 呼叫准入：预留了资源，准入被拒绝的话，即被阻塞。只有成功的完成呼叫准入过程，才能向网络发送流量。分配的带宽不能超过链路的可用带宽。
			- 呼叫建立信令：在呼叫准入过程中要求源到目的地在每台路由器中都预约足够的资源，确保满足QoS请求。
				- 每台路由器都要决定会话所请求的本地资源，在这个过程中会存在着给其他进行会话的资源量，并决定是否有足够资源满足QoS请求。
			- 需要一个信令协议协调这些活动，即本地资源的每跳分配和该呼叫是否能够在经过的路由器中预约足够的资源。呼叫建立协议（call setup protocol），资源预留协议(resource ReSerVation Protocol)。